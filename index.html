{
  "file_name": "index.html",
  "language": "html",
  "code": "<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>F-ray Viewer</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    fontFamily: {\n                        inter: ['Inter', 'sans-serif'],\n                    },\n                    colors: {\n                        primary: '#4CAF50', // 녹색 계열 (예: #4CAF50)\n                        secondary: '#FFC107', // 주황 계열\n                        accent: '#2196F3', // 파랑 계열\n                    }\n                }\n            }\n        }\n    </script>\n    <style>\n        /* 기본 스크롤바 숨기기 (선택 사항) */\n        ::-webkit-scrollbar {\n            display: none;\n        }\n        body {\n            -ms-overflow-style: none;  /* IE and Edge */\n            scrollbar-width: none;  /* Firefox */\n        }\n\n        /* 선택된 환자 강조 스타일 */\n        .patient-list-item.selected {\n            background-color: #e0f2f1; /* 연한 초록색 */\n            font-weight: 600;\n        }\n\n        /* 선택된 사진 강조 스타일 */\n        .photo-list-item.selected {\n            background-color: #e8f5e9; /* 연한 연두색 */\n            border: 1px solid #a5d6a7;\n        }\n\n        /* 전체 화면 시 뷰어 스타일 (JavaScript에서 토글) */\n        .full-screen-viewer {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: 1000;\n            background-color: #1a202c; /* 배경 어둡게 */\n            overflow: hidden; /* 스크롤바 숨기기 */\n        }\n\n        /* 이미지 드래그앤드롭 피드백 */\n        .image-wrapper.drag-over {\n            border: 2px dashed #4CAF50;\n            background-color: rgba(76, 175, 80, 0.1);\n        }\n        .image-wrapper.dragging-source {\n            opacity: 0.5;\n            border: 2px solid #2196F3;\n        }\n\n        /* 이미지 컨테이너 내 드래그 커서 */\n        #image-container.cursor-grabbing {\n            cursor: grabbing;\n            cursor: -webkit-grabbing;\n        }\n\n        /* 캔버스 오버레이 스타일 */\n        #analysisCanvas {\n            position: absolute;\n            top: 0;\n            left: 0;\n            pointer-events: none; /* 캔버스 클릭 이벤트를 아래 이미지로 통과시킵니다. */\n            z-index: 10; /* 이미지 위에 오도록 설정 */\n            /* 캔버스 자체의 transform은 JS에서 applyTransforms 함수로 제어 */\n            transform-origin: top left; /* 확대/축소 기준점 */\n        }\n\n        /* 폰트 사이즈 xxs (Tailwind 기본에 없음, 커스텀 정의) */\n        .text-xxs {\n            font-size: 0.65rem; /* 약 10.4px */\n            line-height: 0.8rem; /* 약 12.8px */\n        }\n    </style>\n</head>\n<body class=\"font-inter antialiased flex h-screen overflow-hidden bg-gray-100\">\n    <div class=\"flex flex-1 overflow-hidden\">\n        <aside id=\"sidebar\" class=\"w-1/3 md:w-1/3 lg:w-1/4 bg-white p-4 flex flex-col shadow-lg overflow-y-auto\">\n            <h1 class=\"text-2xl font-bold mb-4 text-gray-800\">F-ray Viewer</h1>\n            \n            <div class=\"mb-2 flex space-x-2\"> <input type=\"text\" id=\"patientSearch\" placeholder=\"환자 이름 또는 차트 ID 검색\"\n                       class=\"flex-1 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-sm\"> <button id=\"addPatientBtn\"\n                        class=\"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 shadow-md text-sm\"> + 환자\n                </button>\n            </div>\n\n            <div class=\"flex-1 overflow-y-auto border border-gray-200 rounded-md mb-2 bg-gray-50\"> <ul id=\"patientList\" class=\"divide-y divide-gray-200\">\n                    <p class=\"text-center text-gray-500 py-2 text-sm\">환자 목록을 불러오는 중...</p> </ul>\n            </div>\n\n            <div id=\"photoListSection\" class=\"flex-1 overflow-y-auto border border-gray-200 rounded-md bg-gray-50 hidden\">\n                <h2 id=\"photoListHeader\" class=\"text-base font-semibold p-2 bg-gray-100 border-b border-gray-200 sticky top-0 z-10 text-gray-700\"> 선택된 환자의 사진 목록\n                </h2>\n                <div class=\"p-2 bg-white border-b border-gray-200 sticky top-9 z-10 flex flex-col space-y-1\"> <div class=\"flex justify-around text-sm font-medium text-center\">\n                        <button class=\"photo-mode-filter-btn flex-1 p-1 rounded-l-md bg-[#4CAF50] text-white hover:bg-opacity-90 transition-colors duration-200 text-xs\" data-filter=\"all\">전체</button> <button class=\"photo-mode-filter-btn flex-1 p-1 bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors duration-200 text-xs\" data-filter=\"F-ray\">F-ray</button> <button class=\"photo-mode-filter-btn flex-1 p-1 bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors duration-200 text-xs\" data-filter=\"Portrait\">Portrait</button> <button class=\"photo-mode-filter-btn flex-1 p-1 rounded-r-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors duration-200 text-xs\" data-filter=\"UV\">UV</button> </div>\n                    <div class=\"flex space-x-1 mt-1\"> <input type=\"date\" id=\"photoDateFilter\"\n                               class=\"flex-1 p-1 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-2 focus:ring-primary\"> <select id=\"photoProcedureStatusFilter\"\n                                class=\"p-1 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-2 focus:ring-primary\"> <option value=\"all\">모든 시술시기</option>\n                            <option value=\"Before\">시술 전</option>\n                            <option value=\"After\">시술 후</option>\n                            <option value=\"1W\">시술 1주 후</option>\n                            <option value=\"1M\">시술 1개월 후</option>\n                            <option value=\"3M\">시술 3개월 후</option>\n                            <option value=\"6M\">시술 6개월 후</option>\n                            <option value=\"1Y\">시술 1년 후</option>\n                            <option value=\"None\">기타/미지정</option>\n                        </select>\n                        \n                        <select id=\"photoAngleFilter\"\n                                class=\"p-1 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-2 focus:ring-primary\"> <option value=\"all\">전체 각도</option>\n                            <option value=\"C0\">C0</option>\n                            <option value=\"L45\">L45</option>\n                            <option value=\"R45\">R45</option>\n                        </select>\n                    </div>\n                </div>\n                <ul id=\"photoList\" class=\"p-1 grid grid-cols-2 gap-1\"> <p class=\"col-span-2 text-center text-gray-500 py-2 text-xs\">사진 목록을 불러오는 중...</p> </ul>\n            </div>\n\n            <div class=\"mt-4 flex flex-col space-y-2\">\n                <button id=\"importPhotoBtn\"\n                        class=\"w-full py-2 bg-primary text-white rounded-md hover:bg-green-600 transition-colors duration-200 shadow-md\">\n                    사진 불러오기\n                </button>\n                <input type=\"file\" id=\"localFileInput\" accept=\"image/*\" class=\"hidden\">\n            </div>\n        </aside>\n\n        <main id=\"mainViewer\" class=\"flex-1 flex flex-col bg-gray-800 relative md:w-2/3 lg:w-3/4 overflow-hidden\">\n            <div class=\"bg-gray-900 text-white p-3 flex justify-between items-center shadow-md z-20\">\n                <div>\n                    <h2 id=\"viewerPatientName\" class=\"text-lg font-semibold\">사진 뷰어</h2>\n                    <p id=\"viewerPhotoInfo\" class=\"text-sm text-gray-400\">사진 정보를 선택해주세요.</p>\n                </div>\n                <div class=\"flex space-x-2\">\n                    <button id=\"analyzeBtn\" class=\"px-3 py-1 bg-[#E8F5E9] text-[#2E7D32] rounded-full text-sm font-medium hover:bg-green-200 transition-colors duration-200 shadow\">\n                        AI 분석\n                    </button>\n                    <button id=\"compareBtn\" class=\"px-3 py-1 bg-gray-700 text-white rounded-full text-sm font-medium hover:bg-gray-600 transition-colors duration-200 shadow\">\n                        사진 비교\n                    </button>\n                    <button id=\"fullScreenBtn\" class=\"px-3 py-1 bg-gray-700 text-white rounded-full text-sm font-medium hover:bg-gray-600 transition-colors duration-200 shadow\">\n                        전체 화면\n                    </button>\n                    <button id=\"deletePhotoBtn\"\n                            class=\"px-3 py-1 bg-red-500 text-white rounded-full text-sm font-medium hover:bg-red-600 transition-colors duration-200 shadow\">\n                        선택 사진 삭제\n                    </button>\n                </div>\n            </div>\n\n            <div id=\"image-container\" class=\"flex-1 flex justify-center items-center relative overflow-hidden\">\n                <div id=\"viewerPlaceholder\" class=\"absolute inset-0 flex flex-col justify-center items-center text-gray-500\">\n                    <img src=\"https://firebasestorage.googleapis.com/v0/b/frayviewer-63e13.firebasestorage.app/o/images%2FF-RAY_device%20pic_side.jpg?alt=media&token=a61a0421-082f-4165-9df9-9ca47f1a320c\" alt=\"F-ray Device\" class=\"max-w-xs h-auto mb-4\">\n                    <h3 class=\"mt-2 text-lg font-medium\">사진 뷰어</h3>\n                    <p class=\"mt-1 text-sm\">좌측에서 환자를 검색하고 사진을 선택해주세요.</p>\n                </div>\n\n                <div id=\"imageViewer\" class=\"absolute inset-0 flex justify-center items-center p-4 space-x-4 hidden\">\n                    <div id=\"mainImageWrapper\" class=\"image-wrapper relative flex-1 w-full h-full flex justify-center items-center overflow-hidden rounded-lg shadow-xl\" draggable=\"true\" data-photo-id=\"\">\n                        <img id=\"mainImage\" src=\"\" alt=\"Main Image\" class=\"max-w-full max-h-full object-contain transition-transform duration-75 ease-out\">\n                    </div>\n                    <div id=\"compareImageWrapper\" class=\"image-wrapper relative flex-1 w-full h-full flex justify-center items-center overflow-hidden rounded-lg shadow-xl hidden\" draggable=\"true\" data-photo-id=\"\">\n                        <img id=\"compareImage\" src=\"\" alt=\"Compare Image\" class=\"max-w-full max-h-full object-contain transition-transform duration-75 ease-out\">\n                    </div>\n                    <div id=\"tertiaryImageWrapper\" class=\"image-wrapper relative flex-1 w-full h-full flex justify-center items-center overflow-hidden rounded-lg shadow-xl hidden\" draggable=\"true\" data-photo-id=\"\">\n                        <img id=\"tertiaryImage\" src=\"\" alt=\"Tertiary Image\" class=\"max-w-full max-h-full object-contain transition-transform duration-75 ease-out\">\n                    </div>\n\n                    <canvas id=\"analysisCanvas\" class=\"absolute\"></canvas>\n                </div>\n\n                <div class=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-gray-900 bg-opacity-75 p-2 rounded-full shadow-lg z-20\">\n                    <button id=\"zoomInBtn\" class=\"p-2 bg-gray-700 text-white rounded-full hover:bg-gray-600 transition-colors\">\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path></svg>\n                    </button>\n                    <button id=\"zoomOutBtn\" class=\"p-2 bg-gray-700 text-white rounded-full hover:bg-gray-600 transition-colors\">\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"></path></svg>\n                    </button>\n                    <button id=\"resetViewBtn\" class=\"p-2 bg-gray-700 text-white rounded-full hover:bg-gray-600 transition-colors\">\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356-2A8.001 8.001 0 004 12c0 2.972 1.154 5.727 3.039 7.732m0 0l-4.582 2.58m4.582-2.58h2.58m4.356-9.172v-2.58m0 0l-2.58-4.582m2.58 4.582h2.58\"></path>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n\n        \n            <div id=\"analysisPanel\" class=\"absolute right-0 top-0 h-full w-80 bg-gray-900 bg-opacity-90 text-white p-4 shadow-xl z-30 hidden overflow-y-auto\">\n                <div class=\"pt-16\"></div> \n                <h3 class=\"text-xl font-bold mb-4 border-b border-gray-700 pb-2\">AI 분석 결과</h3>\n                \n                <!-- ▼▼▼ MODIFIED: Added Toggle Container ▼▼▼ -->\n                <div id=\"analysisToggleContainer\" class=\"mb-4 p-2 bg-gray-800 rounded-md space-y-2\"></div>\n                <!-- ▲▲▲ END OF MODIFICATION ▲▲▲ -->\n\n                <div id=\"analysisContent\" class=\"text-gray-200 text-sm space-y-4\">\n                    <p>AI 분석 결과를 보려면 사진을 선택하고 'AI 분석' 버튼을 클릭해주세요.</p>\n                </div>\n            </div>\n\n        </main>\n    </div>\n\n    <div id=\"webImageSelectOverlay\" class=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50 hidden\">\n        <div class=\"bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-2/3 lg:w-1/2 max-h-[90vh] flex flex-col\">\n            <div class=\"flex justify-between items-center mb-4\">\n                <h3 class=\"text-xl font-bold text-gray-800\">웹에서 사진 불러오기</h3>\n                <button id=\"closeWebImageSelectModal\" class=\"text-gray-500 hover:text-gray-800 text-2xl font-bold\">&times;</button>\n            </div>\n            <div id=\"storageImageList\" class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 overflow-y-auto flex-1 p-2 border border-gray-200 rounded-md bg-gray-50\">\n                <p class=\"col-span-full text-center text-gray-500 py-4\">Storage 이미지를 불러오는 중...</p>\n            </div>\n        </div>\n    </div>\n\n    <div id=\"importChoiceOverlay\" class=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50 hidden\">\n        <div class=\"bg-white p-6 rounded-lg shadow-xl text-center\">\n            <h3 class=\"text-xl font-bold mb-4 text-gray-800\">사진 불러오기</h3>\n            <p class=\"text-gray-600 mb-6\">어디에서 사진을 불러오시겠습니까?</p>\n            <div class=\"flex justify-center space-x-4\">\n                <button id=\"importFromLocalBtn\" class=\"px-6 py-3 bg-primary text-white rounded-md text-lg font-semibold hover:bg-green-600 transition-colors duration-200 shadow-md\">\n                    PC에서 불러오기\n                </button>\n                <button id=\"importFromWebBtn\" class=\"px-6 py-3 bg-accent text-white rounded-md text-lg font-semibold hover:bg-blue-600 transition-colors duration-200 shadow-md\">\n                    웹에서 불러오기\n                </button>\n            </div>\n            <button id=\"closeImportChoiceModal\" class=\"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl font-bold\">&times;</button>\n        </div>\n    </div>\n\n    <div id=\"compareChoiceOverlay\" class=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50 hidden\">\n        <div class=\"bg-white p-6 rounded-lg shadow-xl text-center\">\n            <h3 class=\"text-xl font-bold mb-4 text-gray-800\">사진 비교 모드 선택</h3>\n            <p class=\"text-gray-600 mb-6\">몇 장의 사진을 비교하시겠습니까?</p>\n            <div class=\"flex justify-center space-x-4\">\n                <button id=\"choose2PhotosBtn\" class=\"px-6 py-3 bg-primary text-white rounded-md text-lg font-semibold hover:bg-green-600 transition-colors duration-200 shadow-md\">\n                    2장 비교\n                </button>\n                <button id=\"choose3PhotosBtn\" class=\"px-6 py-3 bg-accent text-white rounded-md text-lg font-semibold hover:bg-blue-600 transition-colors duration-200 shadow-md\">\n                    3장 비교\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <script type=\"module\" src=\"script.js\"></script>\n</body>\n</html>"
}